# NUT-01: 민트 공개키 교환 (Mint Public Key Exchange)

`mandatory`

---

이 문서는 민트 `Bob`과 월렛 사용자 `Alice` 간의 공개키 교환 과정을 설명한다.  
`Alice`는 이 키들을 사용하여 `Bob`의 블라인드 서명을 언블라인드할 수 있다(참고: [NUT-00][00]).

## 설명

월렛 사용자 `Alice`는 `GET /v1/keys` 요청을 통해 민트 `Bob`으로부터 공개키들을 받는다.  
여러 금액 단위에 대한 전체 공개키 집합을 _keyset_ 이라고 한다.

민트는 자신의 `활성(active)` 키셋만 응답한다. 키셋은 민트가 해당 키로 새로운 출력(output)에 서명할 수 있을 때 `active` 상태로 간주된다.  
비활성 키셋은 입력(input)으로는 받을 수 있지만, 새로운 출력에는 서명하지 않는다.  
활성 키셋은 예를 들어 키 교체(key rotation) 등의 이유로 시간이 지나면서 변경될 수 있다.  
활성 및 비활성 키셋 전체 목록은 별도의 엔드포인트를 통해 조회할 수 있다(참고: [NUT-02][02]).

한 민트가 동시에 여러 키셋을 지원할 수 있지만, `GET /v1/keys` 엔드포인트는 오직 활성 키셋만 반환한다.  
월렛은 특정 키셋(활성 혹은 비활성)의 키를 `GET /v1/keys/{keyset_id}` 엔드포인트를 통해 요청할 수도 있다(참고: [NUT-02][02]).

## 지원되는 통화 단위

민트는 [NUT-04][04]의 민팅(mint) 및 [NUT-05][05]의 멜팅(melt)을 직접 혹은 간접적으로 수행할 수 있는 모든 통화 단위를 지원할 수 있다. 예시:

- `btc`: 비트코인 (소수 단위: 8) — 일반적으로 `sat` 단위 사용을 권장
- `sat`: 비트코인의 최소 단위 (예: `100,000,000 sat = 1 bitcoin`)
- `msat`: `1/1000 sat` (즉, `1,000 msat = 1 sat`)
- `auth`: 블라인드 인증용으로 예약됨(참고: [NUT-22][22])
- [ISO 4217](https://www.iso.org/iso-4217-currency-codes.html) 표준 통화 코드 (예: `usd`, `eur`, `gbp`)
- 스테이블코인 코드 (예: `usdt`, `usdc`, `eurc`, `gyen`)

> [!중요]
> 비트코인, ISO 4217 통화(및 해당 통화에 연동된 스테이블코인)의 경우, 키셋의 금액 값은 **반드시 해당 통화의 최소 단위(Minor Unit)** 로 표현해야 한다.  
> 통화의 최소 단위가 "`0`"인 경우 금액은 정수 단위를 의미한다.
>
> 예시:
>
> - `usd` (소수 단위: 2) `<amount_1> = 1 cent (0.01 USD)`
> - `jpy` (소수 단위: 0) `<amount_1> = 1 JPY`
> - `bhd` (소수 단위: 3) `<amount_1> = 1 fils (0.001 BHD)`
> - `btc` (소수 단위: 8) `<amount_1> = 1 sat (0.00000001 BTC)`
> - `eurc` (EUR에 연동, 소수 단위: 2) `<amount_1> = 1 cent (0.01 EURC)`
> - `gyen` (JPY에 연동, 소수 단위: 0) `<amount_1> = 1 GYEN`

## 키셋 생성

키셋은 민트에 의해 생성된다. 민트는 원하는 키 생성 방법을 자유롭게 선택할 수 있다.  
각 키셋은 공개키로부터 계산 가능한 `id`를 통해 식별된다(참고: [NUT-02][02]).

키셋의 키 구조는 다음과 같다:  
`{<amount_1> : <mint_pubkey_1>, <amount_2> : <mint_pubkey_2>, ...}`  
즉, 민트 `Bob`이 지원하는 각 금액 `<amount_i>`에 대응하는 공개키 `<mint_pubkey_i>` (`K_i`, 참고: [NUT-00][00]).

민트는 반드시 [압축된 Secp256k1 공개키 형식](https://learnmeabitcoin.com/technical/public-key#public-key-format)을 사용해야 한다.

## 예시

### 요청 (Alice)

```http
GET https://mint.host:3338/v1/keys
```

curl 예시:

```bash
curl -X GET https://mint.host:3338/v1/keys
```

### 응답 (Bob)

`GetKeysResponse` 형식:

```json
{
  "keysets": [
    {
      "id": <keyset_id_hex_str>,
      "unit": <currency_unit_str>,
      "keys": {
        <amount_int>: <public_key_str>,
        ...
      }
    }
  ]
}
```

### 예시 응답

```json
{
  "keysets": [
    {
      "id": "009a1f293253e41e",
      "unit": "sat",
      "keys": {
          "1": "02194603ffa36356f4a56b7df9371fc3192472351453ec7398b8da8117e7c3e104",
          "2": "03b0f36d6d47ce14df8a7be9137712c42bcdd960b19dd02f1d4a9703b1f31d7513",
          "4": "0366be6e026e42852498efb82014ca91e89da2e7a5bd3761bdad699fa2aec9fe09",
          "8": "0253de5237f189606f29d8a690ea719f74d65f617bb1cb6fbea34f2bc4f930016d"
      }
    }
  ]
}
```

ISO 4217 통화의 경우, 키셋의 금액은 해당 통화의 최소 단위로 표현된다. (예시는 가독성을 위해 일부 키 생략)

```json
{
  "keysets": [
    {
      "id": "00a2f293253e41f9",
      "unit": "usd",
      "keys": {
          "1": "0229...e101", // 1 cent (0.01 USD)
          "2": "03c0...7512", // 2 cents (0.02 USD)
          "4": "0376...fe00", // 4 cents (0.04 USD)
          "8": "0263...016e"  // 8 cents (0.08 USD)
      }
    }
  ]
}
```

[00]: 00.md  
[01]: 01.md  
[02]: 02.md  
[03]: 03.md  
[04]: 04.md  
[05]: 05.md  
[06]: 06.md  
[07]: 07.md  
[08]: 08.md  
[09]: 09.md  
[10]: 10.md  
[11]: 11.md  
[12]: 12.md  
[22]: 22.md  
